<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bioscan | Pulse Rate</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
  /* --- CSS Styles --- */
  :root { --primary-color: #ff416c; --danger-color: #ff0000; --bg-gradient: linear-gradient(135deg, #0f2027, #203a43, #2c5364); --glass-bg: rgba(255, 255, 255, 0.1); --glass-border: rgba(255, 255, 255, 0.2); --text-color: #ffffff; }
  body { font-family: 'Poppins', sans-serif; background: var(--bg-gradient); background-size: 400% 400%; animation: gradientBG 15s ease infinite; min-height: 100vh; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; color: var(--text-color); overflow-x: hidden; transition: background 0.5s; cursor: pointer; }
  @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
  
  /* SOS Styles */
  @keyframes sos-flash { 0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); border-color: red; } 50% { box-shadow: 0 0 50px 20px rgba(255, 0, 0, 0.5); border-color: #ff4d4d; background: rgba(50, 0, 0, 0.6); } 100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); border-color: red; } }
  .critical-state { animation: sos-flash 1s infinite; border: 2px solid red !important; }
  .critical-bg { background: radial-gradient(circle, #3a0000, #000) !important; }

  header { width: 100%; background: rgba(15, 32, 39, 0.9); backdrop-filter: blur(10px); padding: 15px 0; display: flex; justify-content: center; align-items: center; position: relative; box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); z-index: 100; }
  header h1 { font-size: 1.4rem; margin: 0; font-weight: 600; letter-spacing: 1px; color: var(--primary-color); text-transform: uppercase; pointer-events: none; }
  .back-btn { position: absolute; left: 20px; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--primary-color); color: white; padding: 8px 15px; border-radius: 50px; cursor: pointer; font-size: 14px; transition: 0.3s; display: flex; align-items: center; gap: 5px; z-index: 1000; }
  .back-btn:hover { background: var(--primary-color); color: #fff; box-shadow: 0 0 15px rgba(255, 65, 108, 0.5); }
  
  .container { display: flex; flex-direction: column; justify-content: center; align-items: center; flex-grow: 1; width: 100%; padding: 20px; }
  .card { background: var(--glass-bg); backdrop-filter: blur(16px); border: 1px solid var(--glass-border); border-radius: 25px; padding: 40px; width: 100%; max-width: 500px; text-align: center; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); transition: 0.3s; }
  .sos-banner { display: none; background: red; color: white; font-weight: bold; padding: 10px; border-radius: 10px; margin-bottom: 15px; animation: blink 0.5s infinite alternate; }
  @keyframes blink { from { opacity: 1; } to { opacity: 0.7; } }

  /* --- RESTORED HEART ANIMATION --- */
  .icon-container { margin-bottom: 20px; position: relative; height: 100px; display: flex; align-items: center; justify-content: center; }
  
  #heartIcon { 
    font-size: 6rem; 
    background: -webkit-linear-gradient(#ff4b2b, #ff416c); 
    -webkit-background-clip: text; 
    -webkit-text-fill-color: transparent; 
    filter: drop-shadow(0 0 15px rgba(255, 65, 108, 0.6)); 
    /* Important: Animation name must match the keyframes */
    animation-name: pumping; 
    animation-timing-function: ease-in-out; 
    animation-iteration-count: infinite;
    transform-origin: center;
  }

  /* Original Smooth Animation */
  @keyframes pumping { 
    0% { transform: scale(1); } 
    15% { transform: scale(1.3); filter: drop-shadow(0 0 25px rgba(255, 65, 108, 0.8)); }
    30% { transform: scale(1); } 
    45% { transform: scale(1.15); filter: drop-shadow(0 0 20px rgba(255, 65, 108, 0.6)); }
    60% { transform: scale(1); } 
    100% { transform: scale(1); } 
  }
  
  .pulse-box { background: rgba(0, 0, 0, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0; border: 1px solid rgba(255, 65, 108, 0.3); position: relative; }
  #pulseValue { font-size: 3rem; font-weight: 700; color: #fff; text-shadow: 0 0 15px var(--primary-color); }
  .unit { font-size: 1.5rem; color: var(--primary-color); }
  
  /* Tap Hint */
  #tapHint {
      position: absolute; top: -35px; left: 50%; transform: translateX(-50%);
      background: var(--primary-color); color: white; padding: 5px 15px;
      border-radius: 20px; font-size: 0.85rem; white-space: nowrap;
      box-shadow: 0 0 10px var(--primary-color);
      animation: bounce 1s infinite; pointer-events: none;
  }
  @keyframes bounce { 0%, 100% { transform: translateX(-50%) translateY(0); } 50% { transform: translateX(-50%) translateY(-5px); } }

  .instructions-list { list-style: none; padding: 0; text-align: left; margin-bottom: 30px; }
  .instructions-list li { margin-bottom: 12px; display: flex; align-items: center; gap: 10px; font-size: 0.95rem; color: #e0e0e0; }
  .instructions-list li i { color: var(--primary-color); width: 25px; text-align: center; }
  
  .actions-row { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
  .advice-btn, .voice-btn, .save-btn { padding: 12px 20px; border-radius: 50px; border: none; cursor: pointer; font-size: 16px; font-weight: 600; font-family: 'Poppins', sans-serif; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
  .advice-btn { flex: 2; background: linear-gradient(45deg, #ff416c, #ff4b2b); color: white; box-shadow: 0 4px 15px rgba(255, 65, 108, 0.4); }
  .save-btn { flex: 2; background: linear-gradient(45deg, #11998e, #38ef7d); color: white; box-shadow: 0 4px 15px rgba(56, 239, 125, 0.4); }
  .voice-btn { flex: 1; background: rgba(255,255,255,0.1); border: 1px solid var(--primary-color); color: var(--primary-color); }
  .advice-btn:hover, .voice-btn:hover, .save-btn:hover { transform: translateY(-3px); }
  .voice-btn:hover { background: var(--primary-color); color: white; }
  .advice-box { background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 15px; margin-top: 20px; display: none; font-size: 1.1rem; color: #fff; border-left: 4px solid var(--primary-color); animation: slideDown 0.5s ease; }
  @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

  .confirm-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); z-index: 5000; display: none; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s ease; }
  .confirm-modal.active { display: flex; opacity: 1; }
  .confirm-content { background: linear-gradient(145deg, #152229, #1c2e36); border: 2px solid var(--primary-color); border-radius: 25px; width: 90%; max-width: 400px; padding: 30px; text-align: center; box-shadow: 0 0 50px rgba(255, 65, 108, 0.3); transform: scale(0.8); transition: transform 0.3s ease; }
  .confirm-modal.active .confirm-content { transform: scale(1); }
  .success-icon { font-size: 4rem; color: var(--primary-color); margin-bottom: 20px; animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
  @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.2); } 100% { transform: scale(1); } }
  .confirm-title { font-size: 1.5rem; margin-bottom: 10px; color: #fff; }
  .confirm-text { color: #ccc; margin-bottom: 25px; font-size: 0.95rem; }
  .confirm-btn { background: var(--primary-color); color: #fff; border: none; padding: 12px 30px; border-radius: 50px; font-weight: 700; cursor: pointer; font-size: 1rem; transition: 0.3s; }
  .confirm-btn:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(255, 65, 108, 0.6); }

  /* --- MOBILE RESPONSIVE --- */
  @media (max-width: 768px) {
    header { padding: 10px 15px; }
    header h1 { font-size: 1.1rem; letter-spacing: 0.5px; }
    .back-btn { left: 10px; padding: 6px 12px; font-size: 13px; }
    .back-btn span { display: none; }
    
    .container { padding: 15px 10px; }
    .card { padding: 25px 20px; border-radius: 20px; max-width: 100%; }
    
    .icon-container { height: 85px; margin-bottom: 16px; }
    #heartIcon { font-size: 5rem; }
    
    .pulse-box { padding: 15px; margin: 18px 0; }
    #pulseValue { font-size: 2.5rem; }
    .unit { font-size: 1.2rem; }
    #tapHint { font-size: 0.75rem; padding: 4px 12px; top: -30px; }
    
    .sos-banner { font-size: 0.9rem; padding: 8px; margin-bottom: 12px; }
    
    h3 { font-size: 1.1rem; margin-bottom: 12px; }
    
    .instructions-list { margin-bottom: 20px; }
    .instructions-list li { font-size: 0.85rem; margin-bottom: 10px; gap: 8px; }
    .instructions-list li i { width: 20px; font-size: 0.9rem; }
    
    .actions-row { gap: 8px; }
    .advice-btn, .save-btn, .voice-btn { padding: 10px 16px; font-size: 14px; border-radius: 40px; }
    .voice-btn { flex: 0.8; min-width: 45px; }
    
    .advice-box { font-size: 0.95rem; padding: 12px; margin-top: 15px; }
    
    .confirm-content { padding: 25px 20px; width: 92%; max-width: 350px; }
    .success-icon { font-size: 3rem; margin-bottom: 15px; }
    .confirm-title { font-size: 1.3rem; }
    .confirm-text { font-size: 0.85rem; margin-bottom: 20px; }
    .confirm-btn { padding: 10px 25px; font-size: 0.95rem; }
  }

  @media (max-width: 600px) {
    body { padding-top: 70px; padding: 70px 10px 20px 10px; }
    
    .user-card { 
        height: 60px; 
        padding: 0 10px;
    }
    
    .header-title h2 { 
        font-size: 0.9rem; 
        letter-spacing: 0.5px;
    }
    .header-title span { 
        font-size: 0.75rem; 
    }
    
    .actions { gap: 5px; }
    .btn { 
        width: 35px; 
        height: 35px; 
        font-size: 0.9rem;
    }
    #langBtn { 
        width: 35px; 
        font-size: 0.7rem;
    }

    .measurement-card {
        width: 95%;
        max-width: 95%;
        padding: 20px 15px;
        margin: 10px auto;
    }

    .card-icon {
        font-size: 3rem;
        margin-bottom: 15px;
    }

    .measure-title {
        font-size: 1.2rem;
        margin-bottom: 8px;
    }

    .measure-value {
        font-size: 2.2rem;
        margin: 10px 0;
    }

    .measure-subtitle {
        font-size: 0.85rem;
    }

    .info-grid {
        gap: 8px;
        margin: 15px 0;
    }

    .info-item {
        padding: 8px;
    }

    .info-label {
        font-size: 0.75rem;
    }

    .info-value {
        font-size: 0.95rem;
    }

    .status-badge {
        padding: 6px 12px;
        font-size: 0.8rem;
        margin: 10px 0;
    }

    .card-actions {
        gap: 8px;
        margin-top: 15px;
    }

    .action-btn {
        padding: 10px 15px;
        font-size: 0.85rem;
    }

    .modal-content {
        width: 90%;
        max-width: 90%;
        padding: 20px 15px;
    }

    .qr-title {
        font-size: 1.1rem;
        margin-bottom: 10px;
    }

    #qrcode {
        width: 180px !important;
        height: 180px !important;
    }

    #qrcode canvas,
    #qrcode img {
        width: 180px !important;
        height: 180px !important;
    }

    .qr-info {
        font-size: 0.8rem;
        margin-top: 10px;
    }

    .modal-btn {
        padding: 10px 20px;
        font-size: 0.85rem;
    }
}

@media (max-width: 400px) {
    .user-card {
        height: 55px;
        padding: 0 8px;
    }

    .header-title h2 {
        font-size: 0.8rem;
    }

    .header-title span {
        font-size: 0.7rem;
    }

    .btn {
        width: 32px;
        height: 32px;
        font-size: 0.85rem;
    }

    .measure-value {
        font-size: 2rem;
    }

    .card-icon {
        font-size: 2.5rem;
    }
}
</style>
</head>
<body onclick="unlockAudio()"> <div id="confirmModal" class="confirm-modal">
  <div class="confirm-content">
    <div class="success-icon"><i class="fas fa-check-circle"></i></div>
    <h3 class="confirm-title" id="modalTitle">Success!</h3>
    <p class="confirm-text" id="modalText">Measurement saved successfully.</p>
    <button class="confirm-btn" onclick="closeConfirmModal()">OK</button>
  </div>
</div>

<audio id="alarmSound" loop>
  <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mpeg">
</audio>

<header>
  <button id="backBtn" class="back-btn" onclick="goBack()">
    <i class="fas fa-arrow-left"></i> <span>Back</span>
  </button>
  <h1 id="headerTitle">Pulse Rate</h1>
</header>

<div class="container">
  <div id="sosBanner" class="sos-banner"><i class="fas fa-exclamation-triangle"></i> CRITICAL HEART RATE!</div>
  
  <div class="card" id="mainCard">
    <div class="icon-container">
        <i class="fas fa-heartbeat" id="heartIcon" style="animation-duration: 1s;"></i>
    </div>
    
    <div class="pulse-box">
      <div id="tapHint">Tap anywhere to enable sound üîä</div>
      <span id="pulseValue">--</span> <span class="unit">BPM</span>
    </div>
    
    <h3 id="instrTitle" style="color: var(--primary-color); font-weight: 400; margin-bottom: 15px;">Instructions</h3>
    <ul class="instructions-list" id="instructions">
      <li><i class="fas fa-fingerprint"></i> Place finger steadily.</li>
      <li><i class="fas fa-hand-paper"></i> Do not move.</li>
    </ul>
    
    <div class="actions-row">
      <button class="save-btn" id="saveBtn" onclick="saveMeasurement()">
        <i class="fas fa-save"></i> <span id="saveBtnText">Save</span>
      </button>
      <button class="advice-btn" id="adviceBtn" onclick="showAdvice()">
        <i class="fas fa-user-md"></i> <span id="btnText">Medical Advice</span>
      </button>
      <button class="voice-btn" onclick="speakResult()"><i class="fas fa-volume-up"></i></button>
    </div>
    <div class="advice-box" id="adviceBox"></div>
  </div>
</div>

<script>
  // --- 1. Config ---
  const firebaseConfig = {
    apiKey: "AIzaSyAOwMQhsRM2PdD_FLjW_8Oi1WlFS3EO5pY",
    authDomain: "smart-a76a0.firebaseapp.com",
    databaseURL: "https://smart-a76a0-default-rtdb.firebaseio.com",
    projectId: "smart-a76a0",
    messagingSenderId: "343693501983",
    appId: "1:343693501983:web:10ea3fce9d990a2455172a"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();
  auth.signInAnonymously().catch(console.error);

  const pulseBox = document.getElementById("pulseValue");
  const adviceBox = document.getElementById("adviceBox");
  const sosBanner = document.getElementById("sosBanner");
  const mainCard = document.getElementById("mainCard");
  const heartIcon = document.getElementById("heartIcon");
  const tapHint = document.getElementById("tapHint");
  
  const alarmSound = document.getElementById("alarmSound");
  
  // Audio Context for Realistic Synthesis
  const AudioContext = window.AudioContext || window.webkitAudioContext;
  let audioCtx = null;
  
  const userId = localStorage.getItem("selectedUserId");
  const PATIENT_DATA_PATH = "PatientData";
  
  let isCritical = false;
  let audioUnlocked = false; 
  let beepInterval = null;

  // --- 2. ADVANCED MEDICAL BEEP (Dual Oscillator) ---
  // This mimics a GE Patient Monitor Sound
  function playMonitorBeep() {
      if (!audioCtx || isCritical) return;

      const t = audioCtx.currentTime;
      const osc1 = audioCtx.createOscillator();
      const osc2 = audioCtx.createOscillator();
      const gainNode = audioCtx.createGain();

      // Main Tone (High Pitch)
      osc1.type = 'square'; 
      osc1.frequency.setValueAtTime(880, t); 

      // Harmonic Tone (To make it richer)
      osc2.type = 'sine';
      osc2.frequency.setValueAtTime(1760, t); 

      osc1.connect(gainNode);
      osc2.connect(gainNode);
      gainNode.connect(audioCtx.destination);

      // Sound Envelope (Sharp Blip)
      gainNode.gain.setValueAtTime(0, t);
      gainNode.gain.linearRampToValueAtTime(0.1, t + 0.01);
      gainNode.gain.exponentialRampToValueAtTime(0.001, t + 0.15);

      osc1.start(t);
      osc2.start(t);
      osc1.stop(t + 0.15);
      osc2.stop(t + 0.15);
  }

  // --- 3. Magic Unlock (Runs on any click) ---
  function unlockAudio() {
      if (!audioUnlocked) {
          audioCtx = new AudioContext();
          if (audioCtx.state === 'suspended') audioCtx.resume();
          
          // Silent buffer to unlock iOS
          const buffer = audioCtx.createBuffer(1, 1, 22050);
          const source = audioCtx.createBufferSource();
          source.buffer = buffer;
          source.connect(audioCtx.destination);
          source.start(0);

          audioUnlocked = true;
          tapHint.style.display = 'none';
          
          const val = parseInt(pulseBox.innerText);
          if(!isNaN(val)) updatePulseUI(val);
      }
  }

  // --- 4. Live Reading & Logic ---
  function updatePulseUI(val) {
      if(isNaN(val)) return;
      pulseBox.innerText = val;

      // 1. SOS Logic
      if (val > 120 || val < 50) triggerSOS();
      else clearSOS();

      // 2. Animation (Restored Original)
      const duration = 60 / val; 
      heartIcon.style.animationDuration = `${duration}s`;

      // 3. Sound Loop (Synthesized)
      clearInterval(beepInterval);
      if(audioUnlocked && !isCritical) {
          // Sync sound with animation immediately
          playMonitorBeep();
          beepInterval = setInterval(playMonitorBeep, duration * 1000);
      }
  }

  // --- Firebase ---
  if (userId) {
    db.ref(PATIENT_DATA_PATH + "/" + userId + "/SensorData").on("value", snapshot => {
       const str = snapshot.val() || "";
       if(str && (str.includes("HR=") || str.includes("Pulse="))) {
           const parts = str.split(",");
           const hrPart = parts.find(p => p.trim().startsWith("HR=") || p.trim().startsWith("Pulse="));
           if(hrPart) {
               const val = parseInt(hrPart.split("=")[1]);
               updatePulseUI(val);
           }
       }
    });
  }

  // --- 5. Save Function ---
  function saveMeasurement() {
    const val = pulseBox.innerText;
    if (val === "--" || val === "") return;
    if (!userId) { window.location.href = "index.html"; return; }
    
    let sessionId = localStorage.getItem("currentSessionId");
    if (!sessionId) { sessionId = Date.now().toString(); localStorage.setItem("currentSessionId", sessionId); }

    const timestamp = new Date().toLocaleString();
    db.ref(`${PATIENT_DATA_PATH}/${userId}/History/${sessionId}`).update({
        bpm: val,
        createdAt: timestamp
    });
    
    db.ref(`${PATIENT_DATA_PATH}/${userId}/SensorData`).once('value').then(snapshot => {
        let currentStr = snapshot.val() || "";
        if (currentStr.includes("HR=")) currentStr = currentStr.replace(/HR=[^,]+/, `HR=${val}`);
        else if (currentStr === "No measurement recorded yet") currentStr = `HR=${val}`;
        else currentStr = currentStr ? `${currentStr}, HR=${val}` : `HR=${val}`;
        
        db.ref(`${PATIENT_DATA_PATH}/${userId}`).update({ SensorData: currentStr, Timestamp: timestamp })
          .then(() => showConfirmModal());
    });
  }

  function showConfirmModal() {
      const isAr = localStorage.getItem("language") === "ar";
      document.getElementById("modalTitle").innerText = isAr ? "ÿ™ŸÖ ÿ®ŸÜÿ¨ÿßÿ≠!" : "Success!";
      document.getElementById("modalText").innerText = isAr ? "ÿ™ŸÖ ÿ≠ŸÅÿ∏ ŸÇŸäÿßÿ≥ ÿßŸÑŸÜÿ®ÿ∂ ÿ®ŸÜÿ¨ÿßÿ≠." : "Pulse measurement saved successfully.";
      document.querySelector(".confirm-btn").innerText = isAr ? "ÿ≠ÿ≥ŸÜÿßŸã" : "OK";
      const modal = document.getElementById("confirmModal");
      modal.style.display = "flex";
      setTimeout(() => modal.classList.add("active"), 10);
  }
  function closeConfirmModal() {
      const modal = document.getElementById("confirmModal");
      modal.classList.remove("active");
      setTimeout(() => modal.style.display = "none", 300);
  }

  function triggerSOS() { if(isCritical) return; isCritical = true; clearInterval(beepInterval); document.body.classList.add("critical-bg"); mainCard.classList.add("critical-state"); sosBanner.style.display = "block"; alarmSound.play().catch(e=>{}); const lang = localStorage.getItem("language") || "en"; sosBanner.innerText = lang === "ar" ? "üö® ÿÆÿ∑ÿ±: ŸÜÿ®ÿ∂ ÿ∫Ÿäÿ± ÿ∑ÿ®ŸäÿπŸä!" : "üö® CRITICAL HEART RATE!"; }
  function clearSOS() { if(!isCritical) return; isCritical = false; document.body.classList.remove("critical-bg"); mainCard.classList.remove("critical-state"); sosBanner.style.display = "none"; alarmSound.pause(); alarmSound.currentTime = 0; if(audioUnlocked && !isNaN(parseInt(pulseBox.innerText))) updatePulseUI(parseInt(pulseBox.innerText)); }
  
  function speakResult() {
    let bpm = parseInt(pulseBox.innerText);
    const lang = localStorage.getItem("language") || "en";
    let text = (lang === "ar") ? `ŸÜÿ®ÿ∂ŸÉ ${bpm} ÿØŸÇÿ© ŸÅŸä ÿßŸÑÿØŸÇŸäŸÇÿ©` : `Your heart rate is ${bpm} beats per minute`;
    if(!isNaN(bpm)) window.speechSynthesis.speak(new SpeechSynthesisUtterance(text));
  }

  function showAdvice() {
    let bpm = parseInt(pulseBox.innerText);
    const lang = localStorage.getItem("language") || "en";
    let txt = "";
    if (isNaN(bpm)) txt = lang === "ar" ? "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™." : "No data.";
    else if (bpm > 100) { txt = lang === "ar" ? "ŸÜÿ®ÿ∂ ÿ≥ÿ±Ÿäÿπ! ÿßÿ≥ÿ™ÿ±ÿ≠." : "High pulse! Relax."; adviceBox.style.borderLeftColor = "#ff9900"; }
    else { txt = lang === "ar" ? "ŸÜÿ®ÿ∂ ÿ∑ÿ®ŸäÿπŸä." : "Normal pulse."; adviceBox.style.borderLeftColor = "#00ff88"; }
    adviceBox.innerText = txt; adviceBox.style.display = "block";
  }

  function goBack() { clearSOS(); clearInterval(beepInterval); window.location.href = "measurements.html"; }

  const lang = localStorage.getItem("language") || "en";
  if (lang === "ar") {
    document.body.style.direction = "rtl";
    document.getElementById("headerTitle").innerText = "ŸÇŸäÿßÿ≥ ÿßŸÑŸÜÿ®ÿ∂";
    document.getElementById("backBtn").innerHTML = '<i class="fas fa-arrow-right"></i> <span>ÿπŸàÿØÿ©</span>';
    document.getElementById("backBtn").style.left="auto"; document.getElementById("backBtn").style.right="20px";
    document.getElementById("instrTitle").innerText = "ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑŸÇŸäÿßÿ≥";
    document.getElementById("btnText").innerText = "ÿßŸÑŸÜÿµŸäÿ≠ÿ© ÿßŸÑÿ∑ÿ®Ÿäÿ©";
    document.getElementById("saveBtnText").innerText = "ÿ≠ŸÅÿ∏ ÿßŸÑŸÇŸäÿßÿ≥";
    document.getElementById("instructions").innerHTML = `<li><i class="fas fa-fingerprint"></i> ÿ∂ÿπ ÿ•ÿµÿ®ÿπŸÉ ÿ®ÿ´ÿ®ÿßÿ™.</li><li><i class="fas fa-hand-paper"></i> ŸÑÿß ÿ™ÿ™ÿ≠ÿ±ŸÉ.</li>`;
    document.getElementById("tapHint").innerText = "ÿßÿ∂ÿ∫ÿ∑ ŸÅŸä ÿ£Ÿä ŸÖŸÉÿßŸÜ ŸÑÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿµŸàÿ™ üîä";
  }
</script>

<div style="position: fixed; bottom: 10px; left: 10px; z-index: 9999; display: flex; gap: 5px;">
  <button onclick="updatePulseUI(140)" style="background: red; color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer;">üö® Fast</button>
  <button onclick="updatePulseUI(60)" style="background: green; color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer;">‚úÖ Slow</button>
</div>
</body>
</html>
