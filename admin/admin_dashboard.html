<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Admin Dashboard | Smart System</title>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- 1. CORE THEME VARIABLES (Dark Neon) --- */
        :root {
            --bg-dark: #050505; 
            --bg-panel: rgba(20, 30, 40, 0.6); /* Glass effect */
            --primary-neon: #00e5ff; 
            --secondary-neon: #7000ff; 
            --text-main: #ffffff;
            --text-muted: #a0a0a0;
            --border-glow: 0 0 15px rgba(0, 229, 255, 0.3);
            --danger: #ff2a2a;
            --success: #00ff9d;
        }

        /* --- 2. GLOBAL RESET & ANIMATED BACKGROUND --- */
        * { box-sizing: border-box; outline: none; }
        
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0; padding: 20px;
            color: var(--text-main);
            min-height: 100vh;
            overflow-x: hidden;
            background: linear-gradient(135deg, #000000, #0f172a, #1a1025, #000000);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG { 
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #020202; }
        ::-webkit-scrollbar-thumb { background: var(--primary-neon); border-radius: 4px; box-shadow: 0 0 10px var(--primary-neon); }

        /* --- 3. LAYOUT BLOCKS (THE OLD DESIGN YOU LIKED) --- */
        .main-wrapper {
            max-width: 1400px; margin: 0 auto; width: 100%;
            display: flex; flex-direction: column; gap: 25px;
        }

        /* The Neon Block Container */
        .neon-block {
            background: var(--bg-panel);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 229, 255, 0.15);
            border-radius: 16px;
            padding: 25px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: 0.3s ease;
        }

        .neon-block:hover {
            border-color: rgba(0, 229, 255, 0.5);
            box-shadow: 0 0 20px rgba(0, 229, 255, 0.1);
        }

        .neon-block h3 {
            margin-top: 0;
            color: var(--primary-neon);
            font-size: 1.3rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 15px;
            margin-bottom: 25px;
            display: flex; align-items: center; gap: 10px;
            text-shadow: 0 0 8px rgba(0, 229, 255, 0.4);
            letter-spacing: 1px;
        }

        /* --- 4. HEADER --- */
        header.neon-block {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid var(--primary-neon);
        }

        .header-info h1 { margin: 0; font-size: 1.8rem; text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 15px rgba(0, 229, 255, 0.6); }
        .header-info p { margin: 5px 0 0; color: var(--text-muted); font-size: 0.9rem; }

        /* Buttons */
        .btn-neon {
            background: rgba(0, 229, 255, 0.1); border: 1px solid var(--primary-neon);
            color: var(--primary-neon); padding: 10px 20px; border-radius: 8px;
            cursor: pointer; font-weight: 600; transition: 0.3s;
        }
        .btn-neon:hover { background: var(--primary-neon); color: #000; box-shadow: 0 0 20px var(--primary-neon); }

        .btn-danger {
            background: rgba(255, 42, 42, 0.1); border: 1px solid var(--danger);
            color: var(--danger); padding: 10px 20px; border-radius: 8px;
            cursor: pointer; font-weight: 600; transition: 0.3s;
        }
        .btn-danger:hover { background: var(--danger); color: #fff; box-shadow: 0 0 20px var(--danger); }

        /* --- 5. STATS CARDS --- */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        
        .stat-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.03), rgba(0,0,0,0.2));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px; padding: 20px; text-align: center;
            position: relative; overflow: hidden;
        }
        .stat-card::after {
            content: ''; position: absolute; bottom: 0; left: 0; height: 3px; width: 100%;
            background: var(--primary-neon); box-shadow: 0 0 15px var(--primary-neon);
        }
        .stat-card h4 { margin: 0; color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
        .stat-card .stat-value {
            font-size: 2.5rem; font-weight: 700; color: #fff; margin-top: 10px;
            text-shadow: 0 0 15px rgba(255,255,255,0.3); display: block;
        }

        /* --- 6. MAIN CONTENT GRID --- */
        .content-grid { display: grid; grid-template-columns: 2.5fr 1fr; gap: 25px; }

        /* Data Controls */
        .data-controls { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .neon-input {
            background: rgba(0, 0, 0, 0.6); border: 1px solid #333;
            color: #fff; padding: 12px 15px; border-radius: 8px; flex-grow: 1;
            font-family: inherit; transition: 0.3s;
        }
        .neon-input:focus { border-color: var(--primary-neon); box-shadow: 0 0 10px rgba(0, 229, 255, 0.2); }

        /* Table */
        .table-responsive { overflow-x: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 18px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .data-table th {
            background: rgba(0, 229, 255, 0.15); color: var(--primary-neon);
            font-weight: 700; text-transform: uppercase; font-size: 0.85rem;
        }
        .data-table tr:hover { background: rgba(255, 255, 255, 0.03); }

        /* --- 7. DEVICE TOPOLOGY (INTEGRATED NEW DESIGN) --- */
        .topology-container {
            display: flex; flex-direction: column; align-items: center; gap: 20px; padding: 10px;
        }

        /* Controller (Root) */
        .controller-box {
            background: linear-gradient(145deg, #0a0a0a, #000);
            border: 2px solid var(--secondary-neon);
            padding: 20px 30px; border-radius: 12px; text-align: center;
            box-shadow: 0 0 30px rgba(112, 0, 255, 0.15);
            width: 240px; position: relative; z-index: 2;
        }
        .controller-box i { font-size: 2.5rem; color: var(--secondary-neon); margin-bottom: 10px; display: block; }
        .controller-box .dev-name { display: block; font-weight: 700; color: #fff; margin-bottom: 10px; letter-spacing: 1px; }

        /* Connectors */
        .connector-vertical { width: 2px; height: 25px; background: rgba(255, 255, 255, 0.1); }
        .connector-horizontal { width: 85%; height: 2px; background: rgba(255, 255, 255, 0.1); position: relative; }
        .connector-branches { display: flex; justify-content: space-around; width: 85%; margin-top: -2px; }
        .branch { width: 2px; height: 15px; background: rgba(255, 255, 255, 0.1); }

        /* Sensors Row */
        .sensors-row { display: flex; gap: 15px; width: 100%; justify-content: center; flex-wrap: wrap; }

        .sensor-card {
            background: rgba(0, 0, 0, 0.8); /* Dark Background for contrast */
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px; padding: 15px; text-align: center;
            flex: 1; min-width: 90px; transition: 0.3s;
            position: relative; overflow: hidden;
        }
        
        .sensor-card:hover { transform: translateY(-5px); }
        
        .sensor-card i { font-size: 1.8rem; margin-bottom: 8px; color: #555; transition: 0.3s; }
        .sensor-card div.name { font-size: 0.85rem; color: #ccc; margin-bottom: 10px; font-weight: 600; }

        /* --- STATUS INDICATORS (GLOWING DOTS) --- */
        .status-badge {
            font-size: 0.75rem; padding: 4px 10px; border-radius: 20px;
            background: rgba(0,0,0,0.6); border: 1px solid #333;
            display: inline-flex; align-items: center; gap: 6px;
            font-weight: 600; text-transform: uppercase;
            transition: 0.3s;
        }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: block; }

        /* Online State */
        .is-online { 
            color: var(--success); border-color: var(--success);
            box-shadow: 0 0 10px rgba(0, 255, 157, 0.2);
            text-shadow: 0 0 8px var(--success);
        }
        .is-online .status-dot { 
            background: var(--success); box-shadow: 0 0 8px var(--success);
            animation: pulseGreen 1.5s infinite;
        }

        /* Offline State */
        .is-offline { 
            color: var(--danger); border-color: var(--danger);
            text-shadow: 0 0 8px var(--danger);
        }
        .is-offline .status-dot { 
            background: var(--danger); box-shadow: 0 0 8px var(--danger);
        }

        @keyframes pulseGreen { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        /* Active Card Glow (Border) */
        .sensor-card.active { border-color: var(--primary-neon); box-shadow: 0 0 15px rgba(0, 229, 255, 0.15); }
        .sensor-card.active i { color: var(--primary-neon); transform: scale(1.1); }
        .sensor-card.active .fa-heartbeat { color: #ff0055; animation: beat 1s infinite; }
        .sensor-card.active .fa-thermometer-half { color: #ffae00; }
        .sensor-card.active .fa-lungs { color: #00d2ff; animation: breathe 3s infinite; }
        .sensor-card.active .fa-compress-alt { color: #00ff9d; }

        @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        @keyframes breathe { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }

        /* --- MODAL --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: #0f1215; border: 1px solid var(--primary-neon); padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; box-shadow: 0 0 40px rgba(0, 229, 255, 0.2); }
        .modal-content h3 { color: var(--primary-neon); text-align: center; border-bottom: 1px solid #333; padding-bottom: 15px; margin-top: 0; }
        .modal-content label { display: block; margin: 15px 0 5px; color: #ccc; }

        @media (max-width: 1024px) { .content-grid { grid-template-columns: 1fr; } }
    </style>
</head>

<body>

    <div class="main-wrapper">
        
        <header class="neon-block">
            <div class="header-info">
                <h1 id="headerTitle">Bioscan System</h1>
                <p id="welcomeMessage">Initializing...</p>
            </div>
            <div class="header-controls">
                <button class="btn-danger" onclick="adminLogout()"><i class="fas fa-power-off"></i> Logout</button>
            </div>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <h4>System Efficiency</h4>
                <span class="stat-value" id="statEfficiency">0%</span>
            </div>
            <div class="stat-card">
                <h4>Network Latency</h4>
                <span class="stat-value" id="statLatency">0 ms</span>
            </div>
            <div class="stat-card" id="statRAMBox">
                <h4>RAM Usage</h4>
                <span class="stat-value" id="statRAM">0%</span>
            </div>
        </div>

        <div class="content-grid">
            
            <div class="neon-block">
                <h3><i class="fas fa-users"></i> Patients Database</h3>
                <div class="data-controls">
                    <input type="text" id="patientSearch" class="neon-input" placeholder="Search ID or Name...">
                    <select id="filterSelect" class="neon-input" style="flex-grow:0.5;">
                        <option value="all">All Records</option>
                        <option value="critical">Critical Only</option>
                    </select>
                    <button class="btn-neon" onclick="showAddPatientModal()"><i class="fas fa-plus"></i> Add User</button>
                </div>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Readings</th> 
                                <th>Source</th>          
                                <th>Time</th>       
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="patientDataBody">
                            </tbody>
                    </table>
                </div>
            </div>

            <div style="display: flex; flex-direction: column; gap: 25px;">
                
                <div class="neon-block">
                    <h3><i class="fas fa-project-diagram"></i> Hardware Topology</h3>
                    <div class="topology-container">
                        
                        <div class="controller-box" id="ctrl-box">
                            <i class="fas fa-microchip"></i>
                            <span class="dev-name">ESP-32 Controller</span>
                            <div class="status-badge is-offline" id="ctrl-status">
                                <span class="status-dot"></span> <span id="ctrl-text">Offline</span>
                            </div>
                        </div>

                        <div class="connector-vertical"></div>
                        <div class="connector-horizontal"></div>
                        <div class="connector-branches"><div class="branch"></div><div class="branch"></div></div>

                        <div class="sensors-row">
                            <div class="sensor-card" id="card-temp">
                                <i class="fas fa-thermometer-half"></i>
                                <div class="name">Temp</div>
                                <div class="status-badge is-offline" id="status-temp">
                                    <span class="status-dot"></span> <span id="text-temp">Offline</span>
                                </div>
                            </div>
                            <div class="sensor-card" id="card-pulse">
                                <i class="fas fa-heartbeat"></i>
                                <div class="name">Pulse</div>
                                <div class="status-badge is-offline" id="status-pulse">
                                    <span class="status-dot"></span> <span id="text-pulse">Offline</span>
                                </div>
                            </div>
                            <div class="sensor-card" id="card-bp">
                                <i class="fas fa-compress-alt"></i>
                                <div class="name">BP</div>
                                <div class="status-badge is-offline" id="status-bp">
                                    <span class="status-dot"></span> <span id="text-bp">Offline</span>
                                </div>
                            </div>
                            <div class="sensor-card" id="card-spo2">
                                <i class="fas fa-lungs"></i>
                                <div class="name">SpO2</div>
                                <div class="status-badge is-offline" id="status-spo2">
                                    <span class="status-dot"></span> <span id="text-spo2">Offline</span>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="neon-block">
                    <h3><i class="fas fa-terminal"></i> Command Center</h3>
                    <div style="margin-bottom:15px;">
                        <label style="color:#aaa; font-size:0.9rem; margin-bottom:5px; display:block;">Target Device:</label>
                        <select id="targetDeviceSelect" class="neon-input" style="width:100%;">
                            <option value="Device_001">ESP32_Main_Unit</option>
                        </select>
                        <button class="btn-neon" style="width:100%; margin-top:10px;" onclick="sendCommand('REBOOT')">
                            <i class="fas fa-sync"></i> Reboot System
                        </button>
                    </div>
                    <div>
                        <label style="color:#aaa; font-size:0.9rem; margin-bottom:5px; display:block;">FOTA Update URL:</label>
                        <input type="url" id="firmwareUrlInput" class="neon-input" style="width:100%;" placeholder="http://server/firmware.bin">
                        <button class="btn-neon" style="width:100%; margin-top:10px; border-color:var(--secondary-neon); color:var(--secondary-neon);" onclick="sendCommand('FOTA')">
                            <i class="fas fa-cloud-upload-alt"></i> Deploy Firmware
                        </button>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <div id="addPatientModal" class="modal-overlay">
        <div class="modal-content neon-block">
            <h3>New Record</h3>
            <form id="addPatientForm">
                <label>Patient ID / Phone</label>
                <input type="text" id="patientPhone" class="neon-input" required>
                <label>Sensor Readings</label>
                <input type="text" id="sensorReading" class="neon-input" placeholder="Temp=37, HR=80..." required>
                <label>Source</label>
                <select id="addedSource" class="neon-input">
                    <option value="Admin">Admin</option>
                    <option value="Self">Self</option>
                </select>
                <div style="margin-top:25px; display:flex; justify-content:space-between;">
                    <button type="button" class="btn-danger" onclick="closeAddPatientModal()">Cancel</button>
                    <button type="submit" class="btn-neon">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- 1. FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyAOwMQhsRM2PdD_FLjW_8Oi1WlFS3EO5pY",
            authDomain: "smart-a76a0.firebaseapp.com",
            databaseURL: "https://smart-a76a0-default-rtdb.firebaseio.com",
            projectId: "smart-a76a0",
            messagingSenderId: "343693501983",
            appId: "1:343693501983:web:10ea3fce9d990a2455172a"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // Database Paths
        const DEVICE_PATH = 'DeviceStatus'; // Root path for your topology
        const SYSTEM_HEALTH_PATH = 'SystemHealth/Metrics'; 
        const COMMAND_PATH = 'Commands/'; 
        const PATIENT_DATA_PATH = 'PatientData'; 

        // --- 2. AUTHENTICATION ---
        auth.onAuthStateChanged(user => {
            if (!user) {
                window.location.href = "login.html";
            } else {
                document.getElementById('welcomeMessage').innerText = "Welcome, " + user.email;
                initializeDashboard();
            }
        });

        function logout() {
            auth.signOut().then(() => window.location.href = "login.html");
        }

        function initializeDashboard() {
            monitorSystemPerformance();
            loadPatientData();
            monitorTopology(); // Start listening to new topology structure
        }

        // --- 3. MONITOR TOPOLOGY (New Logic) ---
        function monitorTopology() {
            console.log("Listening to DeviceStatus...");
            
            db.ref(DEVICE_PATH).on('value', snapshot => {
                if(!snapshot.exists()) return;
                const data = snapshot.val();

                // Mapping keys from your Firebase image to UI IDs
                // Structure: data['ESP-32 Controller'].status, data['Temp'].status, etc.

                // 1. Controller
                const espData = data['ESP-32 Controller'];
                updateStatusUI('ctrl-status', 'ctrl-text', 'ctrl-box', espData ? espData.status : 'offline');

                // 2. Temp
                const tempData = data['Temp'];
                updateStatusUI('status-temp', 'text-temp', 'card-temp', tempData ? tempData.status : 'offline');

                // 3. Pulse
                const pulseData = data['Pulse'];
                updateStatusUI('status-pulse', 'text-pulse', 'card-pulse', pulseData ? pulseData.status : 'offline');

                // 4. BP
                const bpData = data['BP'];
                updateStatusUI('status-bp', 'text-bp', 'card-bp', bpData ? bpData.status : 'offline');

                // 5. SpO2
                const spo2Data = data['SpO2'];
                updateStatusUI('status-spo2', 'text-spo2', 'card-spo2', spo2Data ? spo2Data.status : 'offline');
            });
        }

        // Helper to update UI (Colors & Glow)
        function updateStatusUI(badgeId, textId, cardId, status) {
            const badgeEl = document.getElementById(badgeId);
            const textEl = document.getElementById(textId);
            const cardEl = document.getElementById(cardId);

            // Normalize string (handle 'Online', 'online', 'ONLINE')
            const currentStatus = status ? status.toLowerCase() : 'offline';

            if (currentStatus === 'online') {
                textEl.innerText = "Online";
                badgeEl.className = "status-badge is-online"; // Green Glow Class
                if(cardEl) cardEl.classList.add('active'); // Add border glow & animation
            } else {
                textEl.innerText = "Offline";
                badgeEl.className = "status-badge is-offline"; // Red Glow Class
                if(cardEl) cardEl.classList.remove('active'); // Remove animation
            }
        }

        // --- 4. OTHER DASHBOARD FUNCTIONS ---
        
        // System Health
        function monitorSystemPerformance() {
            db.ref(SYSTEM_HEALTH_PATH).on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    const avgLatency = data.Avg_Latency_ms || data.Avg_Latency || 0; 
                    const ramUsage = data.RAM_Usage_Percent || data.RAM || 0; 
                    const efficiency = Math.min(100, Math.max(0, 100 - (avgLatency / 5))); 

                    document.getElementById('statEfficiency').innerText = `${efficiency.toFixed(0)}%`;
                    document.getElementById('statLatency').innerText = `${avgLatency.toFixed(0)} ms`;
                    document.getElementById('statRAM').innerText = `${ramUsage.toFixed(0)}%`;
                    
                    const ramBox = document.getElementById('statRAMBox');
                    ramBox.style.borderColor = ramUsage > 75 ? 'var(--danger)' : 'rgba(255, 255, 255, 0.1)';
                }
            });
        }

        // Patient Data Table
        function loadPatientData() {
            const tableBody = document.getElementById('patientDataBody');
            db.ref(PATIENT_DATA_PATH).on('value', (snapshot) => {
                tableBody.innerHTML = ''; 
                if (!snapshot.exists()) {
                    tableBody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:20px; color:#aaa;">No records found.</td></tr>`;
                    return;
                }
                snapshot.forEach((childSnapshot) => {
                    const patientPhone = childSnapshot.key; 
                    const data = childSnapshot.val();
                    const row = tableBody.insertRow();
                    row.insertCell().innerText = patientPhone; 
                    row.insertCell().innerText = data.SensorData || 'N/A';
                    row.insertCell().innerText = data.AddedBy || 'N/A';
                    row.insertCell().innerText = data.Timestamp || 'N/A';
                    const actionCell = row.insertCell();
                    actionCell.innerHTML = `<button class="btn-danger" style="padding:5px 10px; font-size:0.8rem;" onclick="deletePatient('${patientPhone}')"><i class="fas fa-trash"></i></button>`;
                });
            });
        }

        function adminLogout() {
            auth.signOut().then(() => window.location.href = "login.html");
        }

        // Modal Functions
        function showAddPatientModal() { document.getElementById('addPatientModal').style.display = 'flex'; }
        function closeAddPatientModal() { document.getElementById('addPatientModal').style.display = 'none'; }

        document.getElementById('addPatientForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const phone = document.getElementById('patientPhone').value.trim();
            const sensorData = document.getElementById('sensorReading').value.trim();
            const source = document.getElementById('addedSource').value;
            if (!phone || !sensorData) { alert('Please fill in all fields.'); return; }
            let addedBy = source === 'Admin' ? auth.currentUser.email : source;

            db.ref(PATIENT_DATA_PATH + '/' + phone).set({
                Phone: phone, SensorData: sensorData, Timestamp: new Date().toLocaleString(), AddedBy: addedBy
            }).then(() => { closeAddPatientModal(); });
        });

        function deletePatient(id) {
            if(confirm('Delete record for ' + id + '?')) db.ref(PATIENT_DATA_PATH + '/' + id).remove();
        }

        // Commands
        function sendCommand(type) {
            const dev = document.getElementById('targetDeviceSelect').value;
            const url = document.getElementById('firmwareUrlInput').value;
            let val = type === 'REBOOT' ? 'REBOOT' : url;
            if (type === 'FOTA' && !url.startsWith('http')) { alert('Invalid URL'); return; }
            
            db.ref(COMMAND_PATH + dev).set({ Action: type, Value: val, Timestamp: new Date().toLocaleString() })
              .then(() => alert('Command Sent!'));
        }
    </script>

</body>
</html>
