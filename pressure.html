<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bioscan | Blood Pressure</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
  /* --- CSS Styles --- */
  :root { 
    --bg-gradient: linear-gradient(135deg, #0f2027, #203a43, #2c5364); 
    --glass-bg: rgba(255, 255, 255, 0.05); 
    --glass-border: rgba(255, 255, 255, 0.1); 
    --text-color: #ffffff; 
    --primary-color: #00f2ff; /* Cyan for Systolic */
    --secondary-color: #ff00ff; /* Magenta for Diastolic */
    --track-color: rgba(255, 255, 255, 0.1);
  }
  
  body { font-family: 'Poppins', sans-serif; background: var(--bg-gradient); background-size: 400% 400%; animation: gradientBG 15s ease infinite; min-height: 100vh; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; color: var(--text-color); overflow-x: hidden; transition: background 0.5s; }
  @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
  
  /* SOS Styles */
  @keyframes sos-flash { 0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); border-color: red; } 50% { box-shadow: 0 0 50px 20px rgba(255, 0, 0, 0.5); border-color: #ff4d4d; background: rgba(50, 0, 0, 0.6); } 100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); border-color: red; } }
  .critical-state { animation: sos-flash 1s infinite; border: 2px solid red !important; }
  .critical-bg { background: radial-gradient(circle, #3a0000, #000) !important; }

  header { width: 100%; background: rgba(15, 32, 39, 0.9); backdrop-filter: blur(10px); padding: 15px 0; display: flex; justify-content: center; align-items: center; position: relative; box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); z-index: 100; }
  header h1 { font-size: 1.4rem; margin: 0; font-weight: 600; letter-spacing: 1px; color: var(--primary-color); text-transform: uppercase; pointer-events: none; text-shadow: 0 0 10px var(--primary-color); }
  .back-btn { position: absolute; left: 20px; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--primary-color); color: white; padding: 8px 15px; border-radius: 50px; cursor: pointer; font-size: 14px; transition: 0.3s; display: flex; align-items: center; gap: 5px; z-index: 1000; }
  .back-btn:hover { background: var(--primary-color); color: #000; box-shadow: 0 0 15px var(--primary-color); }
  
  .container { display: flex; flex-direction: column; justify-content: center; align-items: center; flex-grow: 1; width: 100%; padding: 20px; }
  
  /* Darker Card for Contrast */
  .card { 
      background: rgba(0, 0, 0, 0.4); /* Much Darker */
      backdrop-filter: blur(20px); 
      border: 1px solid var(--glass-border); 
      border-radius: 30px; 
      padding: 40px; 
      width: 100%; max-width: 500px; 
      text-align: center; 
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5); 
      transition: 0.3s; 
  }
  
  .sos-banner { display: none; background: red; color: white; font-weight: bold; padding: 10px; border-radius: 10px; margin-bottom: 15px; animation: blink 0.5s infinite alternate; }
  @keyframes blink { from { opacity: 1; } to { opacity: 0.7; } }

  /* --- NEON GAUGE V2 (High Contrast & Scale) --- */
  .gauge-container {
    position: relative; width: 240px; height: 240px; margin: 0 auto 20px;
    display: flex; justify-content: center; align-items: center;
  }

  /* The Scale Ticks (Generated by Conic Gradient) */
  .gauge-scale {
    position: absolute; inset: 0; border-radius: 50%;
    background: conic-gradient(from 180deg, transparent 50%, transparent 50%); /* Placeholder */
    /* We create ticks using a mask */
    background: repeating-conic-gradient(
        from 0deg, 
        rgba(255,255,255,0.1) 0deg 1deg, 
        transparent 1deg 10deg
    );
    mask-image: radial-gradient(transparent 65%, black 65%);
    -webkit-mask-image: radial-gradient(transparent 65%, black 65%);
    opacity: 0.5;
  }

  /* Major Numbers */
  .scale-label { position: absolute; font-size: 0.8rem; color: #aaa; font-weight: bold; }
  .label-0 { bottom: 15%; left: 25%; }
  .label-100 { top: 5%; left: 50%; transform: translateX(-50%); }
  .label-200 { bottom: 15%; right: 25%; }

  /* The Track Ring */
  .gauge-track {
    position: absolute; inset: 15px; border-radius: 50%;
    border: 10px solid #222; /* Dark Track */
    box-shadow: inset 0 0 10px #000;
  }

  /* The Indicators Containers (Rotate these) */
  .hand-container {
    position: absolute; inset: 0;
    transition: transform 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  /* The Glowing Dots */
  .dot {
    position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
    border-radius: 50%;
    box-shadow: 0 0 10px rgba(0,0,0,0.8);
  }
  
  /* Systolic (Outer/Main) */
  .sys-dot {
    width: 20px; height: 20px; background: var(--primary-color);
    box-shadow: 0 0 15px var(--primary-color), 0 0 30px var(--primary-color);
    top: 10px; /* On the track */
    z-index: 2;
  }
  
  /* Diastolic (Inner/Secondary) */
  .dia-dot {
    width: 14px; height: 14px; background: var(--secondary-color);
    box-shadow: 0 0 15px var(--secondary-color);
    top: 25px; /* Slightly inner */
    z-index: 2;
  }

  /* Center Heart */
  .center-display {
      position: absolute; width: 120px; height: 120px;
      background: radial-gradient(circle, #1a1a1a, #000);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      border: 2px solid rgba(255,255,255,0.1);
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
  }
  .center-display i {
      font-size: 3rem;
      background: -webkit-linear-gradient(var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 0 5px var(--primary-color));
      animation: pulseHeart 2s infinite;
  }
  @keyframes pulseHeart { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; filter: drop-shadow(0 0 15px var(--secondary-color)); } }

  /* -------------------------------------- */

  .pressure-box { 
      background: rgba(0, 0, 0, 0.6); 
      border-radius: 15px; padding: 20px; margin: 20px 0; 
      border: 1px solid rgba(255, 255, 255, 0.1); 
      display: flex; justify-content: center; align-items: center; gap: 15px;
  }
  .reading-part { display: flex; flex-direction: column; }
  .reading-label { font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 1px; }
  .reading-val { font-size: 2rem; font-weight: 700; color: #fff; }
  .sys-val { color: var(--primary-color); text-shadow: 0 0 10px rgba(0, 242, 255, 0.3); }
  .dia-val { color: var(--secondary-color); text-shadow: 0 0 10px rgba(255, 0, 255, 0.3); }
  .divider { font-size: 2rem; color: #555; font-weight: 100; }

  .instructions-list { list-style: none; padding: 0; text-align: left; margin-bottom: 30px; }
  .instructions-list li { margin-bottom: 12px; display: flex; align-items: center; gap: 10px; font-size: 0.95rem; color: #ccc; }
  .instructions-list li i { color: var(--primary-color); width: 25px; text-align: center; }
  
  .actions-row { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
  .advice-btn, .voice-btn, .save-btn { padding: 12px 20px; border-radius: 50px; border: none; cursor: pointer; font-size: 16px; font-weight: 600; font-family: 'Poppins', sans-serif; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
  .advice-btn { flex: 2; background: linear-gradient(45deg, #6a11cb, #2575fc); color: white; box-shadow: 0 4px 15px rgba(106, 17, 203, 0.4); }
  .save-btn { flex: 2; background: linear-gradient(45deg, #11998e, #38ef7d); color: white; box-shadow: 0 4px 15px rgba(56, 239, 125, 0.4); }
  .voice-btn { flex: 1; background: rgba(255,255,255,0.1); border: 1px solid var(--primary-color); color: var(--primary-color); }
  .advice-btn:hover, .voice-btn:hover, .save-btn:hover { transform: translateY(-3px); filter: brightness(1.2); }
  .voice-btn:hover { background: var(--primary-color); color: #000; }
  .advice-box { background: rgba(0, 0, 0, 0.5); padding: 15px; border-radius: 15px; margin-top: 20px; display: none; font-size: 1.1rem; color: #fff; border-left: 4px solid var(--primary-color); animation: slideDown 0.5s ease; }
  @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

  /* Modal */
  .confirm-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); z-index: 5000; display: none; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s ease; }
  .confirm-modal.active { display: flex; opacity: 1; }
  .confirm-content { background: linear-gradient(145deg, #152229, #1c2e36); border: 2px solid var(--primary-color); border-radius: 25px; width: 90%; max-width: 400px; padding: 30px; text-align: center; box-shadow: 0 0 50px rgba(106, 17, 203, 0.3); transform: scale(0.8); transition: transform 0.3s ease; }
  .confirm-modal.active .confirm-content { transform: scale(1); }
  .success-icon { font-size: 4rem; color: var(--primary-color); margin-bottom: 20px; animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
  @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.2); } 100% { transform: scale(1); } }
  .confirm-title { font-size: 1.5rem; margin-bottom: 10px; color: #fff; }
  .confirm-text { color: #ccc; margin-bottom: 25px; font-size: 0.95rem; }
  .confirm-btn { background: var(--primary-color); color: #fff; border: none; padding: 12px 30px; border-radius: 50px; font-weight: 700; cursor: pointer; font-size: 1rem; transition: 0.3s; }
  .confirm-btn:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--primary-color); }

  /* --- MOBILE RESPONSIVE --- */
  @media (max-width: 768px) {
    header { padding: 10px 15px; }
    header h1 { font-size: 1.1rem; letter-spacing: 0.5px; }
    .back-btn { left: 10px; padding: 6px 12px; font-size: 13px; }
    .back-btn span { display: none; }
    
    .container { padding: 15px 10px; }
    .card { padding: 25px 20px; border-radius: 20px; max-width: 100%; }
    
    .gauge-container { width: 200px; height: 200px; margin: 0 auto 18px; }
    .gauge-track { inset: 12px; border-width: 8px; }
    .dot { width: 10px; height: 10px; top: 8px; }
    .center-value { font-size: 2rem; }
    .center-label { font-size: 0.7rem; }
    .scale-label { font-size: 0.7rem; }
    
    .bp-display { padding: 15px; margin: 18px 0; }
    .bp-row { gap: 12px; }
    .bp-item { padding: 12px; }
    .bp-label { font-size: 0.75rem; }
    .bp-value { font-size: 2rem; }
    .bp-unit { font-size: 0.9rem; }
    .separator { font-size: 2rem; margin: 0 5px; }
    
    .sos-banner { font-size: 0.9rem; padding: 8px; margin-bottom: 12px; }
    
    h3 { font-size: 1.1rem; margin-bottom: 12px; }
    
    .instructions-list { margin-bottom: 20px; }
    .instructions-list li { font-size: 0.85rem; margin-bottom: 10px; gap: 8px; }
    .instructions-list li i { width: 20px; font-size: 0.9rem; }
    
    .actions-row { gap: 8px; }
    .advice-btn, .save-btn, .voice-btn { padding: 10px 16px; font-size: 14px; border-radius: 40px; }
    .voice-btn { flex: 0.8; min-width: 45px; }
    
    .advice-box { font-size: 0.95rem; padding: 12px; margin-top: 15px; }
    
    .confirm-content { padding: 25px 20px; width: 92%; max-width: 350px; }
    .success-icon { font-size: 3rem; margin-bottom: 15px; }
    .confirm-title { font-size: 1.3rem; }
    .confirm-text { font-size: 0.85rem; margin-bottom: 20px; }
    .confirm-btn { padding: 10px 25px; font-size: 0.95rem; }
  }

  @media (max-width: 600px) {
    body { padding-top: 70px; padding: 70px 10px 20px 10px; }
    
    .user-card { 
        height: 60px; 
        padding: 0 10px;
    }
    
    .header-title h2 { 
        font-size: 0.9rem; 
        letter-spacing: 0.5px;
    }
    .header-title span { 
        font-size: 0.75rem; 
    }
    
    .actions { gap: 5px; }
    .btn { 
        width: 35px; 
        height: 35px; 
        font-size: 0.9rem;
    }
    #langBtn { 
        width: 35px; 
        font-size: 0.7rem;
    }

    .measurement-card {
        width: 95%;
        max-width: 95%;
        padding: 20px 15px;
        margin: 10px auto;
    }

    .card-icon {
        font-size: 3rem;
        margin-bottom: 15px;
    }

    .measure-title {
        font-size: 1.2rem;
        margin-bottom: 8px;
    }

    .pressure-display {
        gap: 8px;
        margin: 10px 0;
    }

    .pressure-value {
        font-size: 2rem;
    }

    .pressure-label {
        font-size: 0.7rem;
    }

    .pressure-separator {
        font-size: 2rem;
        margin: 0 5px;
    }

    .measure-subtitle {
        font-size: 0.85rem;
    }

    .info-grid {
        gap: 8px;
        margin: 15px 0;
    }

    .info-item {
        padding: 8px;
    }

    .info-label {
        font-size: 0.75rem;
    }

    .info-value {
        font-size: 0.95rem;
    }

    .status-badge {
        padding: 6px 12px;
        font-size: 0.8rem;
        margin: 10px 0;
    }

    .card-actions {
        gap: 8px;
        margin-top: 15px;
    }

    .action-btn {
        padding: 10px 15px;
        font-size: 0.85rem;
    }

    .modal-content {
        width: 90%;
        max-width: 90%;
        padding: 20px 15px;
    }

    .qr-title {
        font-size: 1.1rem;
        margin-bottom: 10px;
    }

    #qrcode {
        width: 180px !important;
        height: 180px !important;
    }

    #qrcode canvas,
    #qrcode img {
        width: 180px !important;
        height: 180px !important;
    }

    .qr-info {
        font-size: 0.8rem;
        margin-top: 10px;
    }

    .modal-btn {
        padding: 10px 20px;
        font-size: 0.85rem;
    }
  }

  @media (max-width: 400px) {
    .user-card {
        height: 55px;
        padding: 0 8px;
    }

    .header-title h2 {
        font-size: 0.8rem;
    }

    .header-title span {
        font-size: 0.7rem;
    }

    .btn {
        width: 32px;
        height: 32px;
        font-size: 0.85rem;
    }

    .pressure-value {
        font-size: 1.8rem;
    }

    .card-icon {
        font-size: 2.5rem;
    }
  }
</style>
</head>
<body>

<div id="confirmModal" class="confirm-modal">
  <div class="confirm-content">
    <div class="success-icon"><i class="fas fa-check-circle"></i></div>
    <h3 class="confirm-title" id="modalTitle">Success!</h3>
    <p class="confirm-text" id="modalText">Measurement saved successfully.</p>
    <button class="confirm-btn" onclick="closeConfirmModal()">OK</button>
  </div>
</div>

<audio id="alarmSound" loop>
  <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mpeg">
</audio>

<header>
  <button id="backBtn" class="back-btn" onclick="goBack()">
    <i class="fas fa-arrow-left"></i> <span>Back</span>
  </button>
  <h1 id="headerTitle">Blood Pressure</h1>
</header>

<div class="container">
  <div id="sosBanner" class="sos-banner"><i class="fas fa-exclamation-triangle"></i> CRITICAL ALERT</div>
  
  <div class="card" id="mainCard">
    
    <div class="gauge-container">
        <div class="gauge-scale"></div>
        <span class="scale-label label-0">0</span>
        <span class="scale-label label-100">150</span>
        <span class="scale-label label-200">300</span>

        <div class="gauge-track"></div>
        
        <div class="hand-container" id="sysContainer" style="transform: rotate(-135deg);">
            <div class="dot sys-dot"></div>
        </div>
        
        <div class="hand-container" id="diaContainer" style="transform: rotate(-135deg);">
            <div class="dot dia-dot"></div>
        </div>

        <div class="center-display">
            <i class="fas fa-heartbeat"></i>
        </div>
    </div>

    <div class="pressure-box">
      <div class="reading-part">
          <span class="reading-label">SYS</span>
          <span class="reading-val sys-val" id="sysVal">--</span>
      </div>
      <div class="divider">/</div>
      <div class="reading-part">
          <span class="reading-label">DIA</span>
          <span class="reading-val dia-val" id="diaVal">--</span>
      </div>
      <span class="unit">mmHg</span>
    </div>
    
    <h3 id="instrTitle" style="color: var(--primary-color); font-weight: 400; margin-bottom: 15px;">Instructions</h3>
    <ul class="instructions-list" id="instructions">
      <li><i class="fas fa-chair"></i> Sit calmly.</li>
      <li><i class="fas fa-hand-holding-heart"></i> Relax arm.</li>
    </ul>
    
    <div class="actions-row">
      <button class="save-btn" id="saveBtn" onclick="saveMeasurement()">
        <i class="fas fa-save"></i> <span id="saveBtnText">Save</span>
      </button>
      <button class="advice-btn" id="adviceBtn" onclick="showAdvice()">
        <i class="fas fa-user-md"></i> <span id="btnText">Medical Advice</span>
      </button>
      <button class="voice-btn" onclick="speakResult()"><i class="fas fa-volume-up"></i></button>
    </div>
    <div class="advice-box" id="adviceBox"></div>
  </div>
</div>

<script>
  // --- 1. Config ---
  const firebaseConfig = {
    apiKey: "AIzaSyAOwMQhsRM2PdD_FLjW_8Oi1WlFS3EO5pY",
    authDomain: "smart-a76a0.firebaseapp.com",
    databaseURL: "https://smart-a76a0-default-rtdb.firebaseio.com",
    projectId: "smart-a76a0",
    messagingSenderId: "343693501983",
    appId: "1:343693501983:web:10ea3fce9d990a2455172a"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();
  auth.signInAnonymously().catch(console.error);

  const sysValBox = document.getElementById("sysVal");
  const diaValBox = document.getElementById("diaVal");
  const adviceBox = document.getElementById("adviceBox");
  const sosBanner = document.getElementById("sosBanner");
  const mainCard = document.getElementById("mainCard");
  const alarmSound = document.getElementById("alarmSound");
  
  const sysContainer = document.getElementById("sysContainer");
  const diaContainer = document.getElementById("diaContainer");

  const userId = localStorage.getItem("selectedUserId");
  const PATIENT_DATA_PATH = "PatientData";
  let isCritical = false;

  // --- 2. Live Logic & Gauge Math ---
  function updatePressureUI(valString) {
      if(!valString) return;
      
      const parts = valString.split('/');
      const systolic = parseInt(parts[0]);
      const diastolic = parseInt(parts[1]);
      
      if(!isNaN(systolic) && !isNaN(diastolic)) {
          sysValBox.innerText = systolic;
          diaValBox.innerText = diastolic;

          // Mapping Math:
          // Gauge Range: 0 to 300 mmHg
          // Degrees: -135deg (Start) to +135deg (End) => Total 270 degrees
          // Formula: (Value / 300 * 270) - 135
          
          const maxScale = 300;
          let sysAngle = (systolic / maxScale * 270) - 135;
          let diaAngle = (diastolic / maxScale * 270) - 135;
          
          // Apply Animation
          sysContainer.style.transform = `rotate(${sysAngle}deg)`;
          diaContainer.style.transform = `rotate(${diaAngle}deg)`;

          // Critical Check
          if (systolic > 160 || systolic < 80) triggerSOS();
          else clearSOS();
      }
  }

  if (userId) {
    db.ref(PATIENT_DATA_PATH + "/" + userId + "/SensorData").on("value", snapshot => {
       const str = snapshot.val() || "";
       if(str && str.includes("BP=")) {
           const parts = str.split(",");
           const bpPart = parts.find(p => p.trim().startsWith("BP="));
           if(bpPart) {
               const val = bpPart.split("=")[1];
               if(val && val.includes('/')) updatePressureUI(val);
           }
       }
    });
  }

  // --- 3. Save Function ---
  function saveMeasurement() {
    const s = sysValBox.innerText;
    const d = diaValBox.innerText;
    if (s === "--" || d === "--") return;
    const fullVal = `${s}/${d}`;
    
    if (!userId) { window.location.href = "index.html"; return; }
    
    let sessionId = localStorage.getItem("currentSessionId");
    if (!sessionId) { sessionId = Date.now().toString(); localStorage.setItem("currentSessionId", sessionId); }

    const timestamp = new Date().toLocaleString();
    
    db.ref(`${PATIENT_DATA_PATH}/${userId}/History/${sessionId}`).update({
        pressure: fullVal,
        createdAt: timestamp
    });
    
    db.ref(`${PATIENT_DATA_PATH}/${userId}/SensorData`).once('value').then(snapshot => {
        let currentStr = snapshot.val() || "";
        if (currentStr.includes("BP=")) currentStr = currentStr.replace(/BP=[^,]+/, `BP=${fullVal}`);
        else if (currentStr === "No measurement recorded yet") currentStr = `BP=${fullVal}`;
        else currentStr = currentStr ? `${currentStr}, BP=${fullVal}` : `BP=${fullVal}`;
        
        db.ref(`${PATIENT_DATA_PATH}/${userId}`).update({ SensorData: currentStr, Timestamp: timestamp })
          .then(() => showConfirmModal());
    });
  }

  function showConfirmModal() {
      const isAr = localStorage.getItem("language") === "ar";
      document.getElementById("modalTitle").innerText = isAr ? "ÿ™ŸÖ ÿ®ŸÜÿ¨ÿßÿ≠!" : "Success!";
      document.getElementById("modalText").innerText = isAr ? "ÿ™ŸÖ ÿ≠ŸÅÿ∏ ŸÇŸäÿßÿ≥ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿ®ŸÜÿ¨ÿßÿ≠." : "Blood Pressure saved successfully.";
      document.querySelector(".confirm-btn").innerText = isAr ? "ÿ≠ÿ≥ŸÜÿßŸã" : "OK";
      const modal = document.getElementById("confirmModal");
      modal.style.display = "flex";
      setTimeout(() => modal.classList.add("active"), 10);
  }
  function closeConfirmModal() {
      const modal = document.getElementById("confirmModal");
      modal.classList.remove("active");
      setTimeout(() => modal.style.display = "none", 300);
  }

  function triggerSOS() { if(isCritical) return; isCritical = true; document.body.classList.add("critical-bg"); mainCard.classList.add("critical-state"); sosBanner.style.display = "block"; alarmSound.play().catch(e=>{}); const lang = localStorage.getItem("language") || "en"; sosBanner.innerText = lang === "ar" ? "üö® ÿÆÿ∑ÿ±: ÿ∂ÿ∫ÿ∑ ÿ≠ÿ±ÿ¨!" : "üö® CRITICAL ALERT!"; }
  function clearSOS() { if(!isCritical) return; isCritical = false; document.body.classList.remove("critical-bg"); mainCard.classList.remove("critical-state"); sosBanner.style.display = "none"; alarmSound.pause(); alarmSound.currentTime = 0; }
  
  function speakResult() {
    let s = sysValBox.innerText;
    let d = diaValBox.innerText;
    const lang = localStorage.getItem("language") || "en";
    let text = (lang === "ar") ? `ÿ∂ÿ∫ÿ∑ ÿßŸÑÿØŸÖ ${s} ÿπŸÑŸâ ${d}` : `Blood pressure is ${s} over ${d}`;
    window.speechSynthesis.speak(new SpeechSynthesisUtterance(text));
  }

  function showAdvice() {
    let val = parseInt(sysValBox.innerText);
    const lang = localStorage.getItem("language") || "en";
    let txt = "";
    if (isNaN(val)) txt = lang === "ar" ? "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™." : "No data.";
    else if (val > 140) { txt = lang === "ar" ? "ÿ∂ÿ∫ÿ∑ ŸÖÿ±ÿ™ŸÅÿπ! ŸÇŸÑŸÑ ÿßŸÑŸÖŸÑÿ≠." : "High Pressure! Reduce salt."; adviceBox.style.borderLeftColor = "#ff0000"; }
    else { txt = lang === "ar" ? "ÿ∂ÿ∫ÿ∑ ÿ∑ÿ®ŸäÿπŸä." : "Normal Pressure."; adviceBox.style.borderLeftColor = "#00f2ff"; }
    adviceBox.innerText = txt; adviceBox.style.display = "block";
  }

  function goBack() { clearSOS(); window.location.href = "measurements.html"; }

  const lang = localStorage.getItem("language") || "en";
  if (lang === "ar") {
    document.body.style.direction = "rtl";
    document.getElementById("headerTitle").innerText = "ŸÇŸäÿßÿ≥ ÿ∂ÿ∫ÿ∑ ÿßŸÑÿØŸÖ";
    document.getElementById("backBtn").innerHTML = '<i class="fas fa-arrow-right"></i> <span>ÿπŸàÿØÿ©</span>';
    document.getElementById("backBtn").style.left="auto"; document.getElementById("backBtn").style.right="20px";
    document.getElementById("instrTitle").innerText = "ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑŸÇŸäÿßÿ≥";
    document.getElementById("btnText").innerText = "ÿßŸÑŸÜÿµŸäÿ≠ÿ© ÿßŸÑÿ∑ÿ®Ÿäÿ©";
    document.getElementById("saveBtnText").innerText = "ÿ≠ŸÅÿ∏ ÿßŸÑŸÇŸäÿßÿ≥";
    document.getElementById("instructions").innerHTML = `<li><i class="fas fa-chair"></i> ÿßÿ¨ŸÑÿ≥ ÿ®ŸáÿØŸàÿ°.</li><li><i class="fas fa-hand-holding-heart"></i> ÿßÿ±ÿ≠ ÿ∞ÿ±ÿßÿπŸÉ.</li>`;
  }
</script>

<div style="position: fixed; bottom: 10px; left: 10px; z-index: 9999; display: flex; gap: 5px;">
  <button onclick="updatePressureUI('180/110')" style="background: red; color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer;">üö® High</button>
  <button onclick="updatePressureUI('120/80')" style="background: green; color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer;">‚úÖ Normal</button>
</div>
</body>
</html>
